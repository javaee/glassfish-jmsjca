<?xml version="1.0"?>
<project basedir="." name="RTS Public Build">
    <description>
Exported tasks for build-time integration with RTS
    </description>

<!--===========================================================================
    Adds a deployable component to the Tomato installation (.ear, .rar, .war,
    etc.)
-->
    <macrodef name="add-rts-deployed-component">
        <attribute
            name="path"
            description="Path to file that needs to be deployed in each domain"
        />
        <attribute
            name="name"
            description="Name of the component"
        />
        <attribute
            name="filename"
            description="Filename of the component (includes extension)"
        />
        <attribute
            name="initxml"
            description="Full path to intialization script"
            default="init/scripts/init.xml.template"
        />
        <sequential>
            <property environment="xenv" />        
            
            <pathconvert property="p.path" targetOS="unix">
                <path>
                    <pathelement path="@{path}"/>
                </path>
            </pathconvert>

            <pathconvert property="x.path" targetOS="unix">
                <path>
                    <pathelement path="@{initxml}"/>
                </path>
            </pathconvert>

            <ant inheritrefs="false"
                 inheritall="false"
                 dir="${xenv.STC_ROOT}/RTS"
                 antfile="cmbuild.xml"
                 target="add-deployed-component"
            >
                <property name="component.path" value="${p.path}" />
                <property name="component.name" value="@{name}" />
                <property name="component.file" value="@{filename}" />
                <property name="init.path" value="${x.path}" />
            </ant>
        </sequential>
    </macrodef>

</project>
